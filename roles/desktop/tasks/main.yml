- name: Install packages
  become: yes
  apt:
    name:
      - rofi
      - tmux
      - rxvt-unicode
      - keepassxc
      - xclip
      - xcape
      - xdotool
      - libnotify-bin
    state: latest
  tags: [desktop]

- name: Create dotfolders
  file:
    path: ~/.{{ item }}
    state: directory
  loop:
    - urxvt/ext
    - config/rofi
  tags: [desktop]

- name: Install dotfiles
  copy:
    src: "{{ item }}"
    dest: ~/.{{ item }}
  loop:
    - Xresources
    - urxvt/ext/clipboard
    - config/rofi/config
  tags: [desktop]

- name: Install scripts
  copy:
    src: "{{ item }}"
    dest: "{{ bin_dir }}/{{ item }}"
    mode: 0755
  loop:
    - urxvtmux
  tags: [desktop]

- name: Install global config files
  become: yes
  copy:
    src: "{{ item }}"
    dest: /{{ item }}
  loop:
    - usr/share/X11/xkb/symbols/custom
  tags: [desktop]

- name: Add startup config
  copy:
    content: |
      #!/usr/bin/env bash
      setxkbmap custom
      pkill -f xcape; xcape -e "Control_L=Escape;Super_L=Tab" -t 200
      notify-send -t 1000 'desktop initialized...'
    dest: "{{ startup_dir }}/desktop"
  tags: [desktop]

- name: Make startup config executable
  file:
    path: "{{ startup_dir }}/desktop"
    mode: 0755
  tags: [desktop]
